---
title: "Preprocessing Dataset"
author: "Pedro Antonio Benito Rojano"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Preprocessing Dataset

## Libraries

Library for read dataset.

```{r}
library(readr)
```

Library for data frames processing.

```{r message=FALSE}
library(dplyr)
library(tidyr)
```

Library for R Markdown.

```{r}
library(rmarkdown)
library(knitr)
```

Library for data presentation.

```{r message=FALSE}
library(scales)
```

Library for manage strings.

```{r}
library(stringr)
```

## Load dataset

Load dataset.

```{r message=FALSE}
df <- read_csv("../virusTotal/data/virusTotal.csv")
```

## Inspecting dataset

Dimensions.

```{r}
dim(df)
```
### Types

View witch types are in the dataset.

```{r}
col_types_all <- 
  df %>% 
  sapply(class) %>% 
  unlist()

col_types_table <- 
  col_types_all %>% 
  table()

col_types <- 
  col_types_table %>% 
  as.vector()

names(col_types) <- names(col_types_table)
```
```{r}
col_types
```

As can be seen there are only four col types: numeric, character, logical, and date (POSIX).

Cols with type POSIX.

```{r}
df %>% 
  select(-str_which(col_types_all, "POSIX")) %>% 
  head()
```

The colums 

### NA

#### Percentaje of NA values

```{r}
num_of_NA <- 
  df %>% 
  is.na %>% 
  sum

num_of_values <- 
  df %>% 
  dim %>% 
  prod

NA_percentaje <- 
  (num_of_NA / num_of_values) %>% 
  percent
```
```{r echo=FALSE}
NA_percentaje
```

#### Columns with NA

Colums with NA.

```{r}
num_of_NA_by_column <- 
  df %>% 
  is.na %>% 
  colSums()

num_of_NA_by_column <- 
  num_of_NA_by_column[num_of_NA_by_column!=0]

names_of_colums_with_NA <- 
  names(num_of_NA_by_column)

num_of_cols_with_NA <- 
  num_of_NA_by_column %>% 
  length()

percentaje_of_cols_with_NA <-
  (num_of_cols_with_NA / ncol(df)) %>% 
  percent
```
```{r echo=FALSE}
sprintf("Number of colums with NA values: %d", num_of_cols_with_NA)
sprintf("Percentaje of colums with NA values: %s", as.character(percentaje_of_cols_with_NA))
```

Numeric colums with NA.

```{r}
num_of_numeric_cols_with_NA <- 
  df %>% 
  select_if(is.numeric) %>% 
  select_if(anyNA) %>% 
  ncol()

percentaje_of_numeric_cols_with_NA <- 
  (num_of_numeric_cols_with_NA / ncol(df)) %>% 
  percent()

names_of_numeric_colums_with_NA <- 
  df %>% 
  select_if(is.numeric) %>% 
  select_if(anyNA) %>% 
  colnames()
```
```{r echo=FALSE}
sprintf("Number of numeric colums with NA values: %d", num_of_numeric_cols_with_NA)
sprintf("Percentaje of numeric colums with NA values: %s", as.character(percentaje_of_numeric_cols_with_NA))
```

## Replace NA for 0 into permissions colums

```{r}
df_permissions <- 
  df %>% 
  select(., str_which(colnames(.), "additional_info.androguard.RiskIndicator.PERM")) %>% 
  sapply(function(col) replace_na(col, 0))

df_without_permissions <- 
  df %>% 
  select(., -c(str_which(colnames(.), "additional_info.androguard.RiskIndicator.PERM")))

df <- cbind(df_permissions, df_without_permissions)
```

## As factor

```{r}
labels <- 
  function(n){
    if(n == 5){
      return(c("very low", "low", "medium", "high", "very high"))
    }else if(n == 4){
      return(c("very low", "low", "high", "very high"))
    }else if(n == 3){
      return(c("low", "medium", "high"))
    }else if(n == 2){
      return(c("low", "high"))
    }else{
      stop("Not avalible")
    }
  }

cut_by_quantiles <- 
  function(col){
    labels <- c("very low", "low", "medium", "high", "very high")
    quantiles <- 
      col %>% 
      na.omit() %>% 
      quantile() %>% 
      unique()
    if(length(quantiles) > 2){
      col <- 
        col %>% 
        cut(breaks = quantiles, labels = labels(length(quantiles)-1))
    }
    return(col)
  }

df_cut_by_quantiles <- 
  function(df){
    df_without_numeric <- df[!is.numeric(df)]
    df_numeric <- 
      df %>% 
      select_if(is.numeric)
    df_numeric <- 
      df_numeric %>% 
      lapply(cut_by_quantiles)
    return(cbind(df_without_numeric, df_numeric))
  }

df_test <- 
  df_cut_by_quantiles(df)
```











