---
title: "Virustotal_aRules"
author: "√Ångel Sergio"
date: '2022-05-18'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r librerias}
library(dplyr)
library(arules)
library(magrittr)
library(rmarkdown)
library(readr)
library(stringr)
library(tidyverse)
```


```{r lectura, include=FALSE}
virus <- read_csv('../VirusTotal/data/virusTotal.csv')

 

replace_na_which_colname_match <- 
  function(df, pattern, replacement){
    cols_to_replace <- 
      df %>% 
      colnames() %>% 
      str_which(pattern)
    df_replaced_cols <- 
      df %>% 
      select(all_of(cols_to_replace)) %>% 
      sapply(function(col) replace_na(col, replacement))
    df_without_replaced_cols <- 
      df %>% 
      select(-all_of(cols_to_replace))
    return(cbind(df_without_replaced_cols, df_replaced_cols))
  }

pattern <- "additional_info.androguard.RiskIndicator.PERM"

virus <- 
  virus %>% 
  replace_na_which_colname_match(pattern, 0)




```



```{r lectura, include=FALSE}
rules <- virus %>%
   select(c(additional_info.androguard.RiskIndicator.PERM.DANGEROUS,
             additional_info.androguard.RiskIndicator.PERM.GPS,
             additional_info.androguard.RiskIndicator.PERM.NORMAL,
             additional_info.androguard.RiskIndicator.PERM.PRIVACY,
             additional_info.androguard.RiskIndicator.PERM.INTERNET,
             additional_info.androguard.RiskIndicator.PERM.INSTANT,
             additional_info.androguard.RiskIndicator.PERM.SMS,
             additional_info.androguard.RiskIndicator.PERM.MONEY,
             additional_info.androguard.RiskIndicator.PERM.SYSTEM,
             additional_info.androguard.RiskIndicator.PERM.CALL,
             additional_info.androguard.RiskIndicator.PERM.SIGNATURE,
             additional_info.androguard.RiskIndicator.PERM.DEVELOPMENT,
             additional_info.androguard.RiskIndicator.PERM.PRE23,
             additional_info.androguard.RiskIndicator.PERM.APPOP,
             additional_info.androguard.RiskIndicator.PERM.EPHEMERAL,
             additional_info.androguard.RiskIndicator.PERM.PREINSTALLED,
             additional_info.androguard.RiskIndicator.PERM.INSTALLER,
             additional_info.androguard.RiskIndicator.PERM.RUNTIME
             ))
View(rules)

labels <- 
  function(n){
    if(n == 5){
      return(c("very low", "low", "medium", "high", "very high"))
    }else if(n == 4){
      return(c("very low", "low", "high", "very high"))
    }else if(n == 3){
      return(c("low", "medium", "high"))
    }else if(n == 2){
      return(c("low", "high"))
    }else{
      stop("Not avalible")
    }
  }

cut_by_quantiles <- 
  function(col){
    quantiles <- 
      col %>% 
      na.omit() %>% 
      quantile() %>% 
      unique()
    if(length(quantiles) > 2){
      col <- 
        col %>% 
        cut(breaks = quantiles, labels = labels(length(quantiles)-1), include.lowest = TRUE)
    }
    return(col)
  }

df_cut_by_quantiles <- 
  function(df){
    df_without_numeric <- 
      df[sapply(df, function(col) !is.numeric(col))]
    df_numeric <- 
      df %>% 
      select_if(is.numeric)
    df_numeric <- 
      df_numeric %>% 
      lapply(cut_by_quantiles)
    return(cbind(df_without_numeric, df_numeric))
  }

df_test <- 
  rules  %>% 
  df_cut_by_quantiles()
View(f_test)

```



```{r}
r1 <- apriori(df_2, parameter = list(supp=0.01, conf=0.5))
inspect(r1)
```